## Project Maintenance Playbook

### Purpose & Scope
This playbook explains how the TextToSpeechApp suite (macOS app + web studio) is kept healthy over time. It is written for both human maintainers and AI agents working within the repo. The guidance covers dependency hygiene, framework upgrades, testing expectations, and release sign-off.

### Maintenance Cadence
- **Weekly:** run quick dependency audits (`npm outdated`, `swift package update --dry-run`), triage lint/test failures, skim upstream release notes (Next.js, React, Apple platforms, Convex, Clerk).
- **Monthly:** update non-breaking dependencies, rotate documentation snapshots (screenshots, feature roadmaps), review security posture (entitlements, key handling).
- **Quarterly / Major Features:** plan for framework upgrades (Next.js majors, Swift tools version bumps), validate infrastructure integrations, revisit UX debt.

When a scheduled window is missed, catch up by running the checks in order (weekly → monthly → quarterly) before shipping new features.

### Web Workspace (Next.js)
- **Node & Tooling**
  - Target Node.js 20 LTS (>=18.18 required by Next.js 15). Sync local and CI Node versions before bumping.
  - Keep `npm` aligned with Node LTS; commit the lockfile generated by `npm install`.
- **Dependency Updates**
  1. From `web/`, run `npm install` to sync the lockfile.
  2. Audit with `npm outdated` and group upgrades by risk (patch/minor vs major).
  3. For safe updates run `npm update <package>`; for major bumps read upstream migration notes first.
  4. After each batch, execute `npm run lint`, `npm test`, and `npm run build`. If Playwright coverage is relevant, add `npm run test:e2e`.
  5. Update `Docs/web_mobile_responsiveness_notes.md`, `Docs/WEB_VERSIONING.md`, or feature docs when behaviour changes.
- **Framework Upgrades**
  - **Next.js / React:** bump the `next`, `react`, and `react-dom` entries together. Re-run `next codemod` utilities when release notes recommend it. Inspect `next.config.mjs`, middleware, and Route Handlers for API changes.
  - **Tailwind / ESLint / TypeScript:** follow their upgrade guides; adjust `tailwind.config.ts`, `eslint.config.js`, or `tsconfig.json` as required. Regenerate types with `npx tsc --noEmit`.
  - **Convex / Clerk SDKs:** validate API compatibility by running affected integration tests (`npm test -- --filter` when needed) and verifying `.env.local` secrets remain optional placeholders.
- **Release Checklist**
  - Ensure `web/package.json` version follows SemVer; use `npm version` to bump.
  - Verify the footer badge renders the new version in dev (`npm run dev`) and production (`npm run build && npm run start`).
  - Confirm `Docs/WEB_VERSIONING.md` still reflects the workflow (update if not).
  - Push changes, monitor deployment, and capture UI snapshots if the layout shifts.

### macOS App (Swift / SPM)
- **Toolchain**
  - Built with the Swift 6 toolchain targeting macOS 15 minimum. Align Xcode CLI tools (`xcode-select --print-path`) before building.
  - `Package.swift` pins public dependencies; `Package.resolved` stays ignored to allow agents to resolve locally.
- **Dependency Updates**
  1. Run `swift package update --dry-run` to see available versions.
  2. For approved upgrades, execute `swift package update <PackageName>` or `swift package update` to refresh all.
  3. Build and test via `swift build` / `swift test`. For release parity, run `./build.sh` to ensure entitlements and signing steps remain valid.
  4. Update `Info.plist` or entitlements only when platform policies change; document the intent in `Docs/` and review sandbox permissions.
- **Framework Changes**
  - When bumping the Swift tools version (header of `Package.swift`), verify CI images support it.
  - Adding new system capabilities requires aligning `TextToSpeechApp.entitlements` with the security guidelines (network client only by default).
  - Review Keychain usage to prevent regressions—`KeychainManager` must remain the storage abstraction for secrets.
- **Release Checklist**
  - Confirm `swift test` passes with `--parallel`.
  - Regenerate the `.app` bundle using `./build.sh`; verify it launches via `open TextToSpeechApp.app`.
  - Archive a notarisation-ready build if distributing externally (document steps in `Docs/DEPLOYMENT.md` when applicable).

### Shared Best Practices
- **Branching & Reviews**
  - Work in feature branches; keep commit subjects concise (`type: summary`) once Git history is enabled.
  - Run `swift test` and `npm test` before opening PRs. Mention skipped checks explicitly in the PR description.
- **Security Hygiene**
  - Never commit real API keys. Validate that new secrets route through Keychain (macOS) or environment variables (web).
  - All network calls should continue to use `SecureURLSession` on macOS and Next.js route handlers for the web.
  - Revisit `TextToSpeechApp.entitlements` and `TextToSpeechApp.app` permissions after dependency upgrades.
- **Documentation**
  - Mirror new workflows in `Docs/`—if a maintenance step changes, update this playbook and any specialised doc (e.g., `WEB_VERSIONING.md`, `DEPLOYMENT.md`).
  - Store screenshots in `Docs/screenshots/`, named with `YYYY-MM-DD-context.png`.
- **AI Agent Notes**
  - Announce intent in the task plan, respect existing uncommitted work, and avoid destructive commands (`git reset --hard` etc.).
  - Prefer `rg`/`swift test`/`npm test` for verification. Defer to human maintainers when encountering unexpected merge conflicts or secrets.

### Quick Reference Checklists
**Weekly Web Maintenance**
1. `cd web && npm install`
2. `npm outdated`
3. Upgrade safe packages
4. `npm run lint && npm test && npm run build`
5. Update docs if behaviour changes

**Monthly macOS Maintenance**
1. `swift package update --dry-run`
2. Apply approved upgrades
3. `swift build && swift test`
4. `./build.sh` to confirm signing
5. Review entitlements + Keychain usage

Keep this playbook close when planning maintenance windows. Expand sections as the product surface area grows.
